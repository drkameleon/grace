<!DOCTYPE html>
<html lang="en">
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.24.1/ace.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/vue/3.3.4/vue.global.prod.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bulma/0.9.4/css/bulma.min.css">
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        * { user-select: none; -webkit-user-select: none; }
        #editor { 
            position: absolute;
            top: 0;
            right: 0;
            bottom: 40px;
            left: 0;
            user-select: text;
            -webkit-user-select: text;
        }
        #statusbar {
            position: absolute;
            bottom: 0;
            width: 100%;
            height: 40px;
            background-color: #f5f5f5;
            border-top: 1px solid #ddd;
            display: flex;
            justify-content: space-between;
            align-items: stretch;
        }
        .modal-background {
            background-color: rgba(0, 0, 0, 0.2) !important;
        }
        .select, .position-info { font-size: 0.875rem; }
        .position-info {
            color: #666;
            display: flex;
            align-items: center;
        }
        .position-info span {
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 200px; /* Adjust as needed */
            display: inline-block;
        }
        .settings-button {
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            border-right: 1px solid #ddd;
            height: 100%;
            transition: width 0.2s;
            cursor: pointer;
        }
        .settings-button:hover { background-color: rgba(0,0,0,0.05); }
        .settings-button svg {
            width: 16px;
            height: 16px;
            color: #666;
        }
        .controls {
            display: flex;
            height: 100%;
        }
        .select-wrapper {
            position: relative;
            height: 100%;
            border-left: 1px solid #ddd;
            display: flex;
            align-items: center;
            padding: 0 15px;
        }
        .select-wrapper::after {
            content: "";
            position: absolute;
            right: 8px;
            top: 50%;
            transform: translateY(-50%);
            width: 0;
            height: 0;
            border-left: 4px solid transparent;
            border-right: 4px solid transparent;
            border-top: 4px solid #666;
            pointer-events: none;
        }
        .select-wrapper select {
            border: none;
            background: none;
            padding-right: 1.5em;
            cursor: pointer;
            font-size: 0.875rem;
            color: #666;
            -webkit-appearance: none;
            appearance: none;
        }
        .select-wrapper select:focus {
            outline: none;
        }
        .modal-card {
            width: 400px;
            margin: 0 auto;
            margin-top: 10px !important;
        }
        .modal-card-head {
            padding: 10px 15px;
        }
        .modal-card-body {
            padding: 20px 25px;
        }
        .modal-card-foot {
            padding: 10px 15px;
            justify-content: flex-end;
            background: transparent;
            border-top: 1px solid #eee;
        }
        .modal-card-foot .button {
            background: transparent;
            border: none;
            color: #666;
        }
        .modal-card-foot .button:hover {
            background: rgba(0,0,0,0.05);
        }
        .modal-card-title {
            font-size: 1rem;
        }
        .font-size-control {
            display: flex;
            align-items: center;
            gap: 10px;
            width: 200px;
        }
        .font-size-control input[type="range"] {
            flex: 1;
            height: 6px;
            -webkit-appearance: none;
            background: #ddd;
            border-radius: 3px;
        }
        .font-size-control input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: #4a9eff;
            cursor: pointer;
            border: none;
        }
        .setting-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        .setting-row:last-child {
            margin-bottom: 0;
        }
        .setting-row label {
            color: #666;
            font-size: 0.9em;
        }
        .setting-row select {
            width: 200px;
            padding: 6px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            background-color: #fff;
            font-size: 0.9em;
            color: #333;
        }
        .button.is-small {
            height: 2em;
            padding-left: 1em;
            padding-right: 1em;
        }
        .word-wrap-toggle {
            display: flex;
            align-items: center;
        }
        .word-wrap-toggle input[type="checkbox"] {
            margin-right: 8px;
        }
    </style>
</head>
<body>
    <div id="app">
        <div id="editor">function helloWorld() {
    console.log("Hello, World!");
    return "Hello!";
}</div>
        <div id="statusbar">
            <div class="position-info">
                <div class="settings-button" @click="openSettingsModal">
                    <i data-lucide="settings"></i>
                </div>
                <span>Line: {{ cursor.row }}, Column: {{ cursor.column }}</span>
            </div>
            <div class="controls">
                <div class="select-wrapper">
                    <select v-model="indentSize">
                        <option v-for="size in [1,2,4,8]" :value="size">{{ size }}</option>
                    </select>
                </div>
                <div class="select-wrapper">
                    <select v-model="indentType">
                        <option value="spaces">Spaces</option>
                        <option value="tabs">Tabs</option>
                    </select>
                </div>
                <div class="select-wrapper">
                    <select v-model="syntax">
                        <option value="javascript">JavaScript</option>
                        <option value="python">Python</option>
                        <option value="html">HTML</option>
                        <option value="css">CSS</option>
                    </select>
                </div>
            </div>
        </div>
     
        <div class="modal" :class="{'is-active': isSettingsModalOpen}">
            <div class="modal-background" @click="closeSettingsModal"></div>
            <div class="modal-card">
                <header class="modal-card-head">
                    <p class="modal-card-title">Settings</p>
                    <button class="delete is-small" @click="closeSettingsModal"></button>
                </header>
                <section class="modal-card-body">
                    <div class="setting-row">
                        <label>Font Family</label>
                        <select v-model="selectedFont">
                            <option v-for="font in availableFonts" :value="font">{{ font }}</option>
                        </select>
                    </div>
                    <div class="setting-row">
                        <label>Font Size</label>
                        <div class="font-size-control">
                            <input type="range" v-model="fontSize" min="8" max="24" step="1">
                            <span>{{ fontSize }}px</span>
                        </div>
                    </div>
                    <div class="setting-row">
                        <label>Theme</label>
                        <select v-model="theme">
                            <optgroup label="Dark Themes">
                                <option v-for="theme in darkThemes" :value="theme.value">
                                    {{ theme.label }}
                                </option>
                            </optgroup>
                            <optgroup label="Light Themes">
                                <option v-for="theme in lightThemes" :value="theme.value">
                                    {{ theme.label }}
                                </option>
                            </optgroup>
                        </select>
                    </div>
                    <div class="setting-row">
                        <label>Word Wrap</label>
                        <div class="word-wrap-toggle">
                            <input type="checkbox" v-model="wordWrap">
                            <span>Enable word wrapping</span>
                        </div>
                    </div>
                </section>
                <footer class="modal-card-foot" style="background: white; border-top: 1px solid #eee">
                    <button class="button is-small" @click="restoreDefaults">
                        <i data-lucide="rotate-ccw" class="icon is-small mr-1"></i>
                        Restore Defaults
                    </button>
                </footer>
                <!-- <footer class="modal-card-foot" style="justify-content: center; background: white; border-top: 1px solid #eee">
                    <button class="button is-small is-light" @click="restoreDefaults" style="color: #666">
                        <i data-lucide="rotate-ccw" class="icon is-small mr-1"></i>
                        Restore Defaults
                    </button>
                </footer> -->
            </div>
        </div>
    </div>

    <script>
        const { createApp, onMounted, ref, watch } = Vue;

        createApp({
            setup() {
                const editor = ref(null);
                const cursor = ref({ row: 1, column: 1 });
                const isSettingsModalOpen = ref(false);
                const syntax = ref('javascript');
                const theme = ref('monokai');
                const indentSize = ref(4);
                const indentType = ref('spaces');
                const fontSize = ref(14);
                const selectedFont = ref('Monaco');
                const availableFonts = ref([]);
                const wordWrap = ref(false);

                const defaultSettings = {
                    theme: 'monokai',
                    fontSize: 14,
                    selectedFont: 'Monaco',
                    wordWrap: false
                };

                const darkThemes = [
                    { value: 'ambiance', label: 'Ambiance' },
                    { value: 'chaos', label: 'Chaos' },
                    { value: 'clouds_midnight', label: 'Clouds Midnight' },
                    { value: 'dracula', label: 'Dracula' },
                    { value: 'cobalt', label: 'Cobalt' },
                    { value: 'gruvbox', label: 'Gruvbox' },
                    { value: 'idle_fingers', label: 'Idle Fingers' },
                    { value: 'monokai', label: 'Monokai' },
                    { value: 'nord_dark', label: 'Nord Dark' },
                    { value: 'one_dark', label: 'One Dark' },
                    { value: 'twilight', label: 'Twilight' }
                ];

                const lightThemes = [
                    { value: 'chrome', label: 'Chrome' },
                    { value: 'clouds', label: 'Clouds' },
                    { value: 'crimson_editor', label: 'Crimson Editor' },
                    { value: 'dawn', label: 'Dawn' },
                    { value: 'eclipse', label: 'Eclipse' },
                    { value: 'github', label: 'GitHub' },
                    { value: 'xcode', label: 'Xcode' }
                ];

                async function detectMonospaceFonts() {
                    // Only the fonts from your Font Book listing
                    const allFonts = [
                        'Andale Mono', 'Courier New', 'Inconsolata', 'Menlo', 'Monaco', 
                        'Osaka Mono', 'PT Mono', 'SF Mono', 'Spot Mono', 'Lantinghei',
                        'PCMyongjo', 'DejaVu Sans Mono', 'Liberation Mono', 'Lucida Console',
                        'Fira Code', 'JetBrains Mono', 'Source Code Pro', 'Ubuntu Mono',
                        'Consolas', 'Roboto Mono', 'IBM Plex Mono', 'Anonymous Pro'
                    ];
                    
                    const fonts = await Promise.all(
                        allFonts.map(async font => {
                            try {
                                const fontFace = new FontFace(font, `local("${font}")`);
                                await fontFace.load();
                                return font;
                            } catch {
                                return null;
                            }
                        })
                    );
                    
                    return fonts.filter(font => font !== null);
                }

                function updateSettingsButtonWidth() {
                    const gutter = document.querySelector('.ace_gutter');
                    if (gutter) {
                        document.querySelector('.settings-button').style.width = gutter.offsetWidth + 'px';
                    }
                }

                function openSettingsModal() {
                    isSettingsModalOpen.value = true;
                }

                function closeSettingsModal() {
                    isSettingsModalOpen.value = false;
                }

                function restoreDefaults() {
                    theme.value = defaultSettings.theme;
                    fontSize.value = defaultSettings.fontSize;
                    selectedFont.value = defaultSettings.selectedFont;
                    wordWrap.value = defaultSettings.wordWrap;
                }

                onMounted(async () => {
                    editor.value = ace.edit("editor");
                    editor.value.setTheme("ace/theme/monokai");
                    editor.value.session.setMode("ace/mode/javascript");
                    editor.value.setFontSize(14);

                    editor.value.selection.on('changeCursor', () => {
                        const pos = editor.value.getCursorPosition();
                        cursor.value = {
                            row: pos.row + 1,
                            column: pos.column + 1
                        };
                    });

                    lucide.createIcons();

                    setTimeout(updateSettingsButtonWidth, 100);
                    editor.value.session.on('change', () => setTimeout(updateSettingsButtonWidth, 0));
                    editor.value.session.on('changeScrollLeft', updateSettingsButtonWidth);
                    editor.value.renderer.on('resize', updateSettingsButtonWidth);
                    editor.value.session.on('changeScrollTop', updateSettingsButtonWidth);

                    try {
                        availableFonts.value = await detectMonospaceFonts();
                        if (availableFonts.value.length === 0) {
                            availableFonts.value = ['monospace'];
                        }
                    } catch (e) {
                        console.error('Error detecting fonts:', e);
                        availableFonts.value = ['monospace'];
                    }
                });

                watch([syntax, theme, indentSize, indentType, fontSize, selectedFont, wordWrap], 
                    ([newSyntax, newTheme, newIndentSize, newIndentType, newFontSize, newFont, newWordWrap]) => {
                        if (editor.value) {
                            editor.value.session.setMode(`ace/mode/${newSyntax}`);
                            editor.value.setTheme(`ace/theme/${newTheme}`);
                            editor.value.session.setTabSize(newIndentSize);
                            editor.value.session.setUseSoftTabs(newIndentType === 'spaces');
                            editor.value.setFontSize(parseInt(newFontSize));
                            editor.value.container.style.fontFamily = newFont;
                            editor.value.session.setUseWrapMode(newWordWrap);
                        }
                    }
                );

                return {
                    cursor,
                    isSettingsModalOpen,
                    syntax,
                    theme,
                    indentSize,
                    indentType,
                    fontSize,
                    selectedFont,
                    availableFonts,
                    darkThemes,
                    lightThemes,
                    wordWrap,
                    openSettingsModal,
                    closeSettingsModal,
                    restoreDefaults
                };
            }
        }).mount('#app');
    </script>
</body>
</html>